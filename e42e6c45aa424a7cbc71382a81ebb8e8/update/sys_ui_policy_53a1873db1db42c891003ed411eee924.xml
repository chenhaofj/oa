<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<record_update table="sys_ui_policy">
  <sys_ui_policy action="INSERT_OR_UPDATE">
    <active>true</active>
    <conditions/>
    <description/>
    <global>true</global>
    <inherit>false</inherit>
    <isolate_script>false</isolate_script>
    <model_id/>
    <model_table/>
    <on_load>true</on_load>
    <order>100</order>
    <reverse_if_false>true</reverse_if_false>
    <run_scripts>true</run_scripts>
    <script_false>function onCondition() {}</script_false>
    <script_true>function onCondition() {
      // 设置差旅申请单的名称
     var name = g_form.getDisplayValue('name');
     g_form.setValue('tripPlanName', name === null ? '' : name +'的差旅申请单');

     // 取开始时间和结束时间
     var startTime = g_form.getValue('startTime');
     var endTime = g_form.getValue('endTime');
     if(startTime != null &amp;&amp; endTime != null){
         if(startTime &gt; endTime){
             alert('开始时间不能早于结束时间!');
             g_form.setValue('endTime', startTime);
             return;
         }
         var startTime = startTime.format('yyyy-MM-DD');
         var endTime = endTime.format('yyyy-MM-DD');
         var days = getDaysBetween(startTime, endTime);
         console.log('请假天数' + days);
         g_form.setValue('duration', days);
     }
}

function getDaysBetween(startDate, enDate) {
  const sDate = Date.parse(startDate)
  const eDate = Date.parse(enDate)
  if (sDate &gt; eDate) {
    return 0
  }
  if (sDate === eDate) {
    return 1
  }
  const days = (eDate - sDate) / (1 * 24 * 60 * 60 * 1000)
  return days
}

</script_true>
    <set_values/>
    <short_description>自动计算出差时长</short_description>
    <sys_class_name>sys_ui_policy</sys_class_name>
    <sys_created_by>admin</sys_created_by>
    <sys_created_on>2022-05-31 15:38:20</sys_created_on>
    <sys_domain>global</sys_domain>
    <sys_domain_path>/</sys_domain_path>
    <sys_effective>true</sys_effective>
    <sys_id>53a1873db1db42c891003ed411eee924</sys_id>
    <sys_mod_count>1</sys_mod_count>
    <sys_name/>
    <sys_overrides/>
    <sys_package/>
    <sys_policy/>
    <sys_scope>e42e6c45aa424a7cbc71382a81ebb8e8</sys_scope>
    <sys_update_name/>
    <sys_updated_by>admin</sys_updated_by>
    <sys_updated_on>2022-05-31 15:38:20</sys_updated_on>
    <table>x_yunji_oa_t_trip_plan</table>
    <ui_type>0</ui_type>
    <view/>
  </sys_ui_policy>
</record_update>
